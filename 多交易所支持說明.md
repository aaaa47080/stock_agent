# 🌐 多交易所智能切換功能

## ✨ 新功能亮點

現在系統支持**智能交易所切換**！當在 Binance 找不到交易對時，會自動嘗試使用 OKX。

---

## 🎯 功能說明

### 自動交易所檢測

系統會按優先級自動檢測交易對可用的交易所：

1. **首選**: Binance
2. **備選**: OKX

當你查詢一個交易對時：
- ✅ 如果在 Binance 找到 → 使用 Binance
- ⚠️ 如果在 Binance 找不到 → 自動嘗試 OKX
- ❌ 如果兩個交易所都沒有 → 提示錯誤

---

## 💡 使用範例

### 範例 1: Binance 上的常見幣種

```
你: BTC 可以投資嗎?
```

**系統處理流程:**
1. 檢測到 "BTC"
2. 在 Binance 找到 BTCUSDT ✅
3. 使用 Binance 進行分析
4. 返回分析結果

**輸出:**
```
✅ 在 BINANCE 找到交易對: BTCUSDT
🔍 使用交易所: BINANCE

## 📊 BTCUSDT 投資分析報告
**交易所**: BINANCE
**當前價格**: $43250.5000
...
```

---

### 範例 2: OKX 上的特殊幣種 (如 PI)

```
你: PI 可以投資嗎?
```

**系統處理流程:**
1. 檢測到 "PI"
2. 在 Binance 找不到 PIUSDT ⚠️
3. 自動切換到 OKX
4. 在 OKX 找到 PI-USDT ✅
5. 使用 OKX 進行分析
6. 返回分析結果

**輸出:**
```
⚠️  BINANCE 不支持 PI
✅ 在 OKX 找到交易對: PI-USDT
🔍 使用交易所: OKX

## 📊 PI-USDT 投資分析報告
**交易所**: OKX
**當前價格**: $0.5234
...
```

---

### 範例 3: 所有交易所都沒有

```
你: INVALIDCOIN 可以投資嗎?
```

**系統處理流程:**
1. 檢測到 "INVALIDCOIN"
2. 在 Binance 找不到 ⚠️
3. 在 OKX 也找不到 ⚠️
4. 返回錯誤提示

**輸出:**
```
⚠️  BINANCE 不支持 INVALIDCOIN
⚠️  OKX 不支持 INVALIDCOIN

❌ 在所有支持的交易所 (BINANCE, OKX) 都找不到交易對 INVALIDCOIN
請檢查符號是否正確，或嘗試其他幣種。
```

---

## 🔧 技術細節

### 符號格式轉換

不同交易所使用不同的符號格式：

| 幣種 | Binance 格式 | OKX 格式 |
|------|-------------|----------|
| BTC  | BTCUSDT     | BTC-USDT |
| ETH  | ETHUSDT     | ETH-USDT |
| PI   | PIUSDT      | PI-USDT  |
| XRP  | XRPUSDT     | XRP-USDT |

系統會自動進行格式轉換，你只需輸入 "BTC", "PI" 等簡稱即可。

---

### 檢測流程

```
用戶輸入: "PI"
    ↓
嘗試 Binance
    ├─ 標準化為 "PIUSDT"
    ├─ 嘗試獲取數據
    └─ 找不到 ⚠️
    ↓
自動切換到 OKX
    ├─ 標準化為 "PI-USDT"
    ├─ 嘗試獲取數據
    └─ 找到 ✅
    ↓
使用 OKX 進行分析
    ├─ 現貨市場分析
    ├─ 合約市場分析
    └─ 生成報告
    ↓
返回結果 (標註使用 OKX)
```

---

## 📊 支持的交易所

### 當前支持

| 交易所 | 狀態 | 優先級 | 備註 |
|--------|------|--------|------|
| Binance | ✅ | 1 | 首選交易所 |
| OKX | ✅ | 2 | 備選交易所 |

### 優先級說明

- **優先級 1 (Binance)**: 首先嘗試，流動性好，數據豐富
- **優先級 2 (OKX)**: Binance 找不到時自動使用，支持更多新幣種

---

## 🧪 測試功能

### 測試符號標準化

```bash
python test_multi_exchange.py
```

這會測試：
- ✅ Binance 和 OKX 的符號格式轉換
- ✅ 交易所可用性自動檢測
- ✅ 智能切換邏輯

### 測試完整流程

```bash
# 測試 Binance 上的幣種
python demo_chat.py
# 輸入: BTC 可以投資嗎?

# 測試 OKX 上的幣種
python demo_chat.py
# 輸入: PI 可以投資嗎?
```

---

## 🎨 界面顯示

### Web 界面

在分析報告頂部會顯示使用的交易所：

```markdown
## 📊 PI-USDT 投資分析報告

**交易所**: OKX
**當前價格**: $0.5234

### 🏪 現貨市場
...
```

### 命令行輸出

```
🔍 使用交易所: OKX
✅ 在 OKX 找到交易對: PI-USDT

[節點 1/7] 準備數據...
📰 正在從 CryptoPanic 撈取 PI 的真實新聞...
...
```

---

## 💡 使用建議

### 查詢新幣種

對於剛上線的新幣種，OKX 通常更快上架：

```
你: NEWCOIN 可以投資嗎?
→ 系統會自動檢測並使用有該幣種的交易所
```

### 比較多個幣種

可以同時查詢多個幣種，系統會為每個幣種選擇最佳交易所：

```
你: BTC, PI, ETH 哪些可以投資?
→ BTC: 使用 Binance
→ PI: 使用 OKX
→ ETH: 使用 Binance
```

### 手動指定交易所

如果你知道幣種在特定交易所，可以直接使用傳統命令行：

```bash
# 使用 Binance
python main.py --symbol BTCUSDT --exchange binance

# 使用 OKX
python main.py --symbol PI-USDT --exchange okx
```

---

## ⚠️ 注意事項

1. **API 配額**:
   - 檢測過程會調用 API
   - 建議使用聊天界面，會緩存檢測結果

2. **符號格式**:
   - 輸入時使用簡稱即可 (如 "PI", "BTC")
   - 系統會自動轉換為正確格式

3. **數據差異**:
   - 不同交易所的價格可能有微小差異
   - 分析結果會標註使用的交易所

4. **合約市場**:
   - 並非所有幣種在所有交易所都有合約市場
   - 系統會盡力嘗試，失敗時會提示

---

## 🚀 快速開始

```bash
# 啟動聊天界面
python run_chat.py

# 嘗試查詢不同交易所的幣種
你: BTC 可以投資嗎?  # Binance
你: PI 可以投資嗎?   # OKX (如果 Binance 沒有)
你: ETH 可以投資嗎?  # Binance
```

---

## 📚 相關文件

- **chat_interface.py** - 包含智能切換邏輯
- **data_fetcher.py** - 交易所數據獲取
- **test_multi_exchange.py** - 測試腳本
- **使用說明.md** - 快速開始指南

---

**享受多交易所智能切換帶來的便利！** 🎉
