================================================================================
                        è«–å£‡åŠŸèƒ½é–‹ç™¼é€²åº¦è¨˜éŒ„
                        Pi Crypto Insight Forum
================================================================================

æœ€å¾Œæ›´æ–°ï¼š2026-01-19

================================================================================
ä¸€ã€é–‹ç™¼ç¸½è¦½
================================================================================

ç›®æ¨™ï¼šå»ºç«‹é¡ PTT å½¢å¼çš„ç¤¾ç¾¤è¨è«–å€ï¼Œçµåˆ Pi Network æ”¯ä»˜æ©Ÿåˆ¶

åƒè€ƒæ–‡ä»¶ï¼š
- forum_planning.txt (å®Œæ•´è¦åŠƒæ›¸)
- error.txt (åœ˜éšŠè¨è«–è¨˜éŒ„)

================================================================================
äºŒã€å·²å®Œæˆé …ç›® âœ…
================================================================================

ã€Phase 1: è³‡æ–™åº«å±¤ã€‘ âœ… å·²å®Œæˆ (2026-01-19)

1. è³‡æ–™åº«æ¨¡çµ„é‡æ§‹
   -------------------------------------------------------------------------
   å°‡åŸæœ¬çš„ core/database.py (1600+ è¡Œ) æ‹†åˆ†ç‚ºæ¨¡çµ„åŒ–çµæ§‹ï¼š

   core/database/
   â”œâ”€â”€ __init__.py      # çµ±ä¸€å°å‡ºæ‰€æœ‰å‡½æ•¸ï¼Œä¿æŒå‘å¾Œå…¼å®¹
   â”œâ”€â”€ connection.py    # é€£æ¥ç®¡ç†ã€init_db()ã€æ‰€æœ‰è³‡æ–™è¡¨å®šç¾©
   â”œâ”€â”€ user.py          # ç”¨æˆ¶èªè­‰ã€Pi Networkã€æœƒå“¡ç­‰ç´š
   â”œâ”€â”€ chat.py          # å°è©±æ­·å²ã€sessions
   â”œâ”€â”€ forum.py         # è«–å£‡åŠŸèƒ½ï¼ˆçœ‹æ¿ã€æ–‡ç« ã€å›è¦†ã€æ‰“è³ã€æ¨™ç±¤ï¼‰
   â”œâ”€â”€ trading.py       # è‡ªé¸æ¸…å–®ã€é æ¸¬ã€æ’è¡Œæ¦œ
   â””â”€â”€ cache.py         # ç³»çµ±å¿«å–

2. æ–°å¢è«–å£‡ç›¸é—œè³‡æ–™è¡¨ (7 å¼µ)
   -------------------------------------------------------------------------
   - boards            çœ‹æ¿è¡¨ï¼ˆå·²é è¨­å»ºç«‹ã€ŒåŠ å¯†è²¨å¹£ã€çœ‹æ¿ï¼‰
   - posts             æ–‡ç« è¡¨
   - forum_comments    å›è¦†è¡¨ï¼ˆæ¨/å™“/ä¸€èˆ¬å›è¦†ï¼‰
   - tips              æ‰“è³è¨˜éŒ„è¡¨
   - tags              æ¨™ç±¤çµ±è¨ˆè¡¨
   - post_tags         æ–‡ç« æ¨™ç±¤é—œè¯è¡¨
   - user_daily_comments  ç”¨æˆ¶æ¯æ—¥å›è¦†è¨ˆæ•¸è¡¨

3. users è¡¨æ–°å¢æ¬„ä½
   -------------------------------------------------------------------------
   - membership_tier        æœƒå“¡ç­‰ç´š (free/pro)
   - membership_expires_at  PRO æœƒå“¡åˆ°æœŸæ™‚é–“

4. æ–°å¢è³‡æ–™åº«å‡½æ•¸ (30+)
   -------------------------------------------------------------------------
   æœƒå“¡ã€çœ‹æ¿ã€æ–‡ç« ã€å›è¦†ã€æ‰“è³ã€æ¨™ç±¤ã€ç”¨æˆ¶çµ±è¨ˆç­‰å®Œæ•´ CRUD å‡½æ•¸

5. ç´¢å¼•å„ªåŒ–
   -------------------------------------------------------------------------
   å»ºç«‹ 11 å€‹ç´¢å¼•ä»¥åŠ é€ŸæŸ¥è©¢

--------------------------------------------------------------------------------

ã€Phase 2: å¾Œç«¯ APIã€‘ âœ… å·²å®Œæˆ (2026-01-19)

1. API æ¨¡çµ„çµæ§‹
   -------------------------------------------------------------------------
   å°‡ API æŒ‰åŠŸèƒ½æ‹†åˆ†ç‚ºæ¨¡çµ„åŒ–çµæ§‹ï¼š

   api/routers/forum/
   â”œâ”€â”€ __init__.py      # çµ±ä¸€è·¯ç”±æ•´åˆ
   â”œâ”€â”€ models.py        # è«‹æ±‚/å›æ‡‰æ¨¡å‹å®šç¾©
   â”œâ”€â”€ boards.py        # çœ‹æ¿ API (2 ç«¯é»)
   â”œâ”€â”€ posts.py         # æ–‡ç«  API (5 ç«¯é»)
   â”œâ”€â”€ comments.py      # å›è¦† API (5 ç«¯é»)
   â”œâ”€â”€ tips.py          # æ‰“è³ API (3 ç«¯é»)
   â”œâ”€â”€ tags.py          # æ¨™ç±¤ API (3 ç«¯é»)
   â””â”€â”€ me.py            # å€‹äººå¾Œå° API (6 ç«¯é»)

2. å·²å¯¦ä½œçš„ API ç«¯é» (å…± 24 å€‹)
   -------------------------------------------------------------------------

   ã€çœ‹æ¿ç›¸é—œã€‘
   GET  /api/forum/boards              å–å¾—çœ‹æ¿åˆ—è¡¨
   GET  /api/forum/boards/{slug}       å–å¾—çœ‹æ¿è©³æƒ…

   ã€æ–‡ç« ç›¸é—œã€‘
   GET  /api/forum/posts               å–å¾—æ–‡ç« åˆ—è¡¨ï¼ˆæ”¯æ´ç¯©é¸ï¼‰
   POST /api/forum/posts               ç™¼è¡¨æ–°æ–‡ç« ï¼ˆéœ€é©—è­‰ä»˜è²»ï¼‰
   GET  /api/forum/posts/{id}          å–å¾—æ–‡ç« è©³æƒ…
   PUT  /api/forum/posts/{id}          ç·¨è¼¯æ–‡ç« 
   DELETE /api/forum/posts/{id}        åˆªé™¤æ–‡ç« 

   ã€å›è¦†ç›¸é—œã€‘
   GET  /api/forum/posts/{id}/comments       å–å¾—å›è¦†åˆ—è¡¨
   POST /api/forum/posts/{id}/comments       æ–°å¢å›è¦†
   POST /api/forum/posts/{id}/push           æ¨æ–‡ï¼ˆå¿«æ·ï¼‰
   POST /api/forum/posts/{id}/boo            å™“æ–‡ï¼ˆå¿«æ·ï¼‰
   GET  /api/forum/posts/{id}/comment-status å–å¾—å›è¦†ç‹€æ…‹

   ã€æ‰“è³ç›¸é—œã€‘
   POST /api/forum/posts/{id}/tip      æ‰“è³æ–‡ç« 
   GET  /api/forum/tips/sent           å–å¾—é€å‡ºçš„æ‰“è³è¨˜éŒ„
   GET  /api/forum/tips/received       å–å¾—æ”¶åˆ°çš„æ‰“è³è¨˜éŒ„

   ã€æ¨™ç±¤ç›¸é—œã€‘
   GET  /api/forum/tags                å–å¾—æ¨™ç±¤åˆ—è¡¨/æœå°‹
   GET  /api/forum/tags/trending       å–å¾—ç†±é–€æ¨™ç±¤
   GET  /api/forum/tags/{name}/posts   å–å¾—æ¨™ç±¤æ–‡ç« 

   ã€å€‹äººå¾Œå°ã€‘
   GET  /api/forum/me/stats            å–å¾—æˆ‘çš„çµ±è¨ˆè³‡æ–™
   GET  /api/forum/me/posts            å–å¾—æˆ‘çš„æ–‡ç« åˆ—è¡¨
   GET  /api/forum/me/tips/sent        å–å¾—é€å‡ºçš„æ‰“è³è¨˜éŒ„
   GET  /api/forum/me/tips/received    å–å¾—æ”¶åˆ°çš„æ‰“è³è¨˜éŒ„
   GET  /api/forum/me/payments         å–å¾—ç™¼æ–‡ä»˜æ¬¾è¨˜éŒ„
   GET  /api/forum/me/membership       å–å¾—æœƒå“¡ç‹€æ…‹

3. è·¯ç”±è¨»å†Š
   -------------------------------------------------------------------------
   å·²åœ¨ api_server.py ä¸­è¨»å†Š forum_router

================================================================================
ä¸‰ã€å¾…é–‹ç™¼é …ç›® ğŸ“‹
================================================================================

ã€Phase 3: å‰ç«¯é é¢ã€‘ â³ å¾…é–‹ç™¼

ä½ç½®ï¼šweb/forum/

éœ€è¦å»ºç«‹çš„é é¢ï¼š

1. æ–‡ç« åˆ—è¡¨é  (index.html æˆ– board.html)
   -------------------------------------------------------------------------
   - æ–‡ç« åˆ—è¡¨ï¼ˆæ¨™é¡Œã€åˆ†é¡ã€ä½œè€…ã€æ¨å™“æ•¸ã€æ—¥æœŸï¼‰
   - åˆ†é¡ç¯©é¸æ¨™ç±¤
   - ç†±é–€æ¨™ç±¤
   - ç™¼æ–‡æŒ‰éˆ•
   - åˆ†é åŠŸèƒ½

2. æ–‡ç« è©³æƒ…é  (post.html)
   -------------------------------------------------------------------------
   - æ–‡ç« å…§å®¹
   - æ¨/å™“/å›è¦†åŠŸèƒ½
   - æ‰“è³æŒ‰éˆ•
   - å›è¦†åˆ—è¡¨ï¼ˆæ”¯æ´å·¢ç‹€ï¼‰

3. ç™¼æ–‡é é¢ (create.html)
   -------------------------------------------------------------------------
   - çœ‹æ¿é¸æ“‡ï¼ˆç›®å‰åƒ…åŠ å¯†è²¨å¹£ï¼‰
   - åˆ†é¡ä¸‹æ‹‰é¸å–®
   - æ¨™é¡Œè¼¸å…¥
   - å…§å®¹ç·¨è¼¯å™¨
   - æ¨™ç±¤è¼¸å…¥
   - Pi æ”¯ä»˜æ•´åˆï¼ˆå…è²»æœƒå“¡ï¼‰

4. å€‹äººå¾Œå° (dashboard.html)
   -------------------------------------------------------------------------
   - æˆ‘çš„æ–‡ç« 
   - äº¤æ˜“è¨˜éŒ„ï¼ˆç™¼æ–‡ä»˜æ¬¾ã€æ‰“è³ï¼‰
   - çµ±è¨ˆè³‡æ–™
   - æœƒå“¡ç‹€æ…‹

5. JavaScript æ¨¡çµ„ (forum.js)
   -------------------------------------------------------------------------
   - API å‘¼å«å°è£
   - é é¢æ¸²æŸ“é‚è¼¯
   - Pi æ”¯ä»˜æ•´åˆ

--------------------------------------------------------------------------------

ã€Phase 4: Pi Network æ”¯ä»˜æ•´åˆã€‘ â³ å¾…é–‹ç™¼

1. ç™¼æ–‡ä»˜è²»æµç¨‹
   -------------------------------------------------------------------------
   - å‰ç«¯å‘¼å« Pi.createPayment()
   - å¾Œç«¯é©—è­‰äº¤æ˜“
   - è¨˜éŒ„ tx_hash åˆ° posts è¡¨

2. æ‰“è³æµç¨‹
   -------------------------------------------------------------------------
   - P2P æ”¯ä»˜ï¼ˆç”¨æˆ¶éŒ¢åŒ… â†’ ä½œè€…éŒ¢åŒ…ï¼‰
   - è¨˜éŒ„åˆ° tips è¡¨
   - æ›´æ–°æ–‡ç«  tips_total

3. PRO æœƒå“¡è¨‚é–±
   -------------------------------------------------------------------------
   - è¨‚é–±ä»˜è²»æµç¨‹
   - æ›´æ–° membership_tier å’Œ membership_expires_at

================================================================================
å››ã€æŠ€è¡“å‚™è¨»
================================================================================

1. å‘å¾Œå…¼å®¹æ€§
   -------------------------------------------------------------------------
   è³‡æ–™åº«æ¨¡çµ„æ‹†åˆ†å¾Œï¼ŒåŸæœ¬çš„å°å…¥æ–¹å¼ä»ç„¶æœ‰æ•ˆï¼š

   from core.database import get_connection, create_user, get_posts

2. è³‡æ–™åº«è·¯å¾‘
   -------------------------------------------------------------------------
   DB_PATH = D:\okx\stock_agent\user_data.db

3. é è¨­çœ‹æ¿
   -------------------------------------------------------------------------
   init_db() æœƒè‡ªå‹•å»ºç«‹ã€ŒåŠ å¯†è²¨å¹£ã€çœ‹æ¿ (slug: crypto)

4. æœƒå“¡é™åˆ¶
   -------------------------------------------------------------------------
   - å…è²»æœƒå“¡æ¯æ—¥å›è¦†ä¸Šé™ï¼š20 å‰‡
   - PRO æœƒå“¡ï¼šç„¡é™åˆ¶

5. API èªè­‰
   -------------------------------------------------------------------------
   ç›®å‰ API ä½¿ç”¨ user_id ä½œç‚º Query åƒæ•¸é€²è¡Œè­˜åˆ¥
   æœªä¾†å¯è€ƒæ…®åŠ å…¥ JWT Token èªè­‰

================================================================================
äº”ã€ç›¸é—œæª”æ¡ˆ
================================================================================

å·²å»ºç«‹ï¼š
- core/database/__init__.py
- core/database/connection.py
- core/database/user.py
- core/database/chat.py
- core/database/forum.py
- core/database/trading.py
- core/database/cache.py
- api/routers/forum/__init__.py
- api/routers/forum/models.py
- api/routers/forum/boards.py
- api/routers/forum/posts.py
- api/routers/forum/comments.py
- api/routers/forum/tips.py
- api/routers/forum/tags.py
- api/routers/forum/me.py

å¾…å»ºç«‹ï¼š
- web/forum/index.html
- web/forum/post.html
- web/forum/create.html
- web/forum/dashboard.html
- web/js/forum.js

================================================================================
å…­ã€API æ¸¬è©¦æŒ‡ä»¤
================================================================================

å•Ÿå‹•ä¼ºæœå™¨å¾Œï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¸¬è©¦ APIï¼š

# å–å¾—çœ‹æ¿åˆ—è¡¨
curl http://localhost:8111/api/forum/boards

# å–å¾—æ–‡ç« åˆ—è¡¨
curl http://localhost:8111/api/forum/posts

# å–å¾—ç†±é–€æ¨™ç±¤
curl http://localhost:8111/api/forum/tags/trending

# ç™¼è¡¨æ–‡ç« ï¼ˆéœ€æä¾› user_idï¼‰
curl -X POST "http://localhost:8111/api/forum/posts?user_id=test_user" \
  -H "Content-Type: application/json" \
  -d '{"board_slug":"crypto","category":"chat","title":"æ¸¬è©¦æ¨™é¡Œ","content":"æ¸¬è©¦å…§å®¹"}'

================================================================================
                              è¨˜éŒ„çµæŸ
================================================================================
