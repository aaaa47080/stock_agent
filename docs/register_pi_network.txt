# Pi Network App 註冊與部署指南

## 一、前置條件

1. 在 Pi Mining App 中**驗證 Email**（必須）
2. 安裝 Pi Browser

---

## 二、Cloudflare Tunnel 啟用流程（推薦）

Cloudflare Tunnel 提供免費、穩定的 HTTPS URL，比 ngrok 更適合 Pi 開發。

### 步驟 1：安裝 Cloudflare Tunnel

```bash
winget install cloudflare.cloudflared
```

### 步驟 2：啟動 Tunnel

```bash
cloudflared tunnel --url http://localhost:8111
```

### 步驟 3：取得公開 URL

啟動後會顯示類似：
```
https://xxx-xxx-xxx-xxx.trycloudflare.com
```

這就是您的公開 HTTPS URL。

### 注意事項
- 每次重啟 Cloudflare Tunnel，URL 會變更
- 如需固定 URL，需要註冊 Cloudflare 帳號並設定 Named Tunnel

---

## 三、Pi Developer Portal 註冊流程

### 步驟 1：進入 Developer Portal
在 Pi Browser 輸入：`develop.pi`

### 步驟 2：註冊新應用
點擊 **"Register a New App"** 或 **"New App"**

### 步驟 3：填寫應用資訊
- **App Name**：決定您的應用 URL（只用字母、數字、空格，不要特殊字元）
- **Description**：描述您的應用功能

### 步驟 4：選擇網路（重要！）
- **Pi Testnet**：測試用，使用免費的 Test-Pi（推薦先選這個）
- **Pi Mainnet**：正式環境，真實 Pi 交易

### 步驟 5：完成 App Checklist
1. **設定 Hosting**：驗證域名所有權
2. **建立 App Wallet**：在 `wallet.pi` 建立錢包
3. **取得 API Key**：保存好，後端驗證需要

### 步驟 6：設定 Development URL
填入您的 Cloudflare Tunnel URL：
```
https://xxx-xxx-xxx-xxx.trycloudflare.com
```

---

## 四、域名驗證設定

### 伺服器端設定（已完成）

在 `api_server.py` 中已加入驗證路由：

```python
PI_VALIDATION_KEY = "您的驗證碼"

@app.get("/validation-key.txt", response_class=PlainTextResponse)
async def pi_validation():
    return PI_VALIDATION_KEY
```

### 驗證步驟
1. 從 Developer Portal 取得驗證碼（灰色框內容）
2. 更新 `api_server.py` 中的 `PI_VALIDATION_KEY`
3. 重啟伺服器
4. 確認 `https://您的URL/validation-key.txt` 可以訪問
5. 在 Developer Portal 點擊 **"Verify Domain"**

---

## 五、SDK 設定

### 前端設定（web/js/auth.js）

```javascript
Pi.init({
    version: "2.0",
    sandbox: true  // true = Testnet, false = Mainnet
});
```

**重要**：`sandbox` 設定必須與 Developer Portal 註冊的網路一致！
- 註冊 Testnet → `sandbox: true`
- 註冊 Mainnet → `sandbox: false`

---

## 六、測試流程

### 方法 1：使用 Sandbox URL（推薦）
Pi 會提供一個官方測試 URL：
```
https://sandbox.minepi.com/mobile-app-ui/app/您的AppID
```

### 方法 2：使用 Cloudflare Tunnel URL
直接在 Pi Browser 輸入您的 Cloudflare URL

---

## 七、常見問題

### Q: 點擊登入沒反應？
1. 確認在 Pi Browser 中開啟
2. 確認 `sandbox` 設定與註冊網路一致
3. 確認已完成域名驗證

### Q: URL 每次都變？
- Cloudflare Tunnel：每次重啟會變
- 解決方案：使用 Named Tunnel 或部署到 Vercel/Railway 等平台

### Q: 如何取得固定 URL？
推薦部署到以下免費平台：
- Vercel
- Cloudflare Pages
- Railway
- Render

---

## 八、當前專案設定

- **Cloudflare URL**: https://strict-header-points-regarded.trycloudflare.com
- **Validation Key**: 3f976384939a5237ed6b540a7ad666ef9715fc06f51cbdf660621e9dadf14ff4cb3971613d3a0cdef24caaee705ccbed7782bc09ca9bbad2a75768175f97afb9
- **SDK Sandbox**: 請確認 web/js/auth.js 中的設定

---

## 九、相關文件連結

- Pi Developer Guide: https://pi-apps.github.io/community-developer-guide/
- Pi Platform Docs: https://github.com/pi-apps/pi-platform-docs
- Demo Apps: https://pi-apps.github.io/community-developer-guide/docs/gettingStarted/demoApps/
