# 🤖 多模型辯論配置指南

## 🎯 功能簡介

**多模型辯論** 讓不同的 AI 模型扮演多頭和空頭研究員進行辯論，大幅提升分析的：
- **多樣性**: 不同模型有不同的思考方式
- **可信度**: 避免單一模型的偏見
- **深度**: 更全面的觀點碰撞
- **客觀性**: 多個"大腦"的集體智慧

---

## 🌟 為什麼要用多模型辯論？

### 單模型的局限
```
❌ 同一個模型扮演多空雙方
   → 思維模式相同
   → 可能有一致性偏見
   → 辯論深度有限
```

### 多模型的優勢
```
✅ 不同模型扮演多空雙方
   → Claude 保守穩健 vs GPT 激進創新
   → 真正的觀點碰撞
   → 更高質量的辯論
   → 發現更多盲點
```

---

## 📖 快速開始

### 1. 設置環境變量

編輯 `.env` 文件:

```bash
# OpenAI API Key (必需)
OPENAI_API_KEY=sk-your-openai-api-key

# OpenRouter API Key (可選，用於訪問更多模型)
OPENROUTER_API_KEY=sk-or-your-openrouter-api-key
```

### 2. 配置模型 (config.py)

#### 選項 A: 使用 OpenAI 模型 (默認)

```python
# 啟用多模型辯論
ENABLE_MULTI_MODEL_DEBATE = True

# 多頭研究員: GPT-4o (樂觀激進)
BULL_RESEARCHER_MODEL = {
    "provider": "openai",
    "model": "gpt-4o",
}

# 空頭研究員: o4-mini (保守謹慎)
BEAR_RESEARCHER_MODEL = {
    "provider": "openai",
    "model": "o4-mini",
}
```

#### 選項 B: 使用 OpenRouter 多種模型

```python
# 啟用多模型辯論
ENABLE_MULTI_MODEL_DEBATE = True

# 多頭研究員: Claude 3.5 Sonnet (穩健分析)
BULL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "anthropic/claude-3.5-sonnet",
}

# 空頭研究員: GPT-4o (創新思維)
BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "openai/gpt-4o",
}
```

#### 選項 C: 混合使用

```python
# 多頭用 OpenAI
BULL_RESEARCHER_MODEL = {
    "provider": "openai",
    "model": "gpt-4o",
}

# 空頭用 OpenRouter 的 Gemini
BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "google/gemini-pro-1.5",
}
```

### 3. 運行分析

```bash
# 使用聊天界面
python run_chat.py

# 或使用命令行
python main.py --symbol BTCUSDT
```

---

## 🎭 推薦的模型組合

### 組合 1: Claude vs GPT (經典對決) ⭐ 推薦

```python
BULL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "anthropic/claude-3.5-sonnet",  # 保守穩健
}

BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "openai/gpt-4o",  # 激進創新
}
```

**特點:**
- ✅ Claude: 分析深入，風險識別強
- ✅ GPT-4o: 創新思維，機會發現敏銳
- ✅ 辯論質量高，觀點互補

---

### 組合 2: GPT vs Gemini (多樣性)

```python
BULL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "openai/gpt-4o",
}

BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "google/gemini-pro-1.5",
}
```

**特點:**
- ✅ GPT-4o: 商業化成熟，分析專業
- ✅ Gemini: Google 視角，數據分析強
- ✅ 不同公司的模型，避免生態偏見

---

### 組合 3: 開源 vs 商業

```python
BULL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "meta-llama/llama-3.1-70b-instruct",  # 開源
}

BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "anthropic/claude-3.5-sonnet",  # 商業
}
```

**特點:**
- ✅ Llama: 開源社區智慧
- ✅ Claude: 商業化精雕細琢
- ✅ 不同發展路徑的思維碰撞

---

### 組合 4: 全開源 (經濟實惠)

```python
BULL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "qwen/qwen-2.5-72b-instruct",  # 中國開源
}

BEAR_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "meta-llama/llama-3.1-70b-instruct",  # 美國開源
}
```

**特點:**
- ✅ 成本低
- ✅ 不同地區的開源模型
- ✅ 適合高頻分析

---

## 🔧 可用模型列表

### Anthropic Claude 系列 (保守穩健)

| 模型 | OpenRouter 名稱 | 特點 |
|------|----------------|------|
| Claude 3.5 Sonnet | `anthropic/claude-3.5-sonnet` | 最新，分析深入 ⭐ |
| Claude 3 Opus | `anthropic/claude-3-opus` | 最強，但較貴 |
| Claude 3 Haiku | `anthropic/claude-3-haiku` | 快速，經濟 |

### OpenAI 系列 (創新激進)

| 模型 | OpenRouter 名稱 | 特點 |
|------|----------------|------|
| GPT-4o | `openai/gpt-4o` | 最新多模態 ⭐ |
| GPT-4o Mini | `openai/gpt-4o-mini` | 經濟版 |
| GPT-4 Turbo | `openai/gpt-4-turbo` | 穩定經典 |

### Google Gemini 系列 (數據分析強)

| 模型 | OpenRouter 名稱 | 特點 |
|------|----------------|------|
| Gemini Pro 1.5 | `google/gemini-pro-1.5` | 長上下文 ⭐ |
| Gemini Flash 1.5 | `google/gemini-flash-1.5` | 快速響應 |

### Meta Llama 系列 (開源領先)

| 模型 | OpenRouter 名稱 | 特點 |
|------|----------------|------|
| Llama 3.1 405B | `meta-llama/llama-3.1-405b-instruct` | 最大開源模型 |
| Llama 3.1 70B | `meta-llama/llama-3.1-70b-instruct` | 平衡性能成本 ⭐ |

### 其他優秀模型

| 模型 | OpenRouter 名稱 | 特點 |
|------|----------------|------|
| Qwen 2.5 72B | `qwen/qwen-2.5-72b-instruct` | 中國開源之光 ⭐ |
| DeepSeek Chat | `deepseek/deepseek-chat` | 數學推理強 |

---

## ⚙️ 高級配置

### 關閉多模型辯論

如果想用回單一模型（節省成本）:

```python
# 關閉多模型辯論
ENABLE_MULTI_MODEL_DEBATE = False
```

### 自定義交易員模型

```python
TRADER_MODEL = {
    "provider": "openrouter",
    "model": "anthropic/claude-3.5-sonnet",  # 用 Claude 做最終決策
}
```

### 性能 vs 成本權衡

| 配置 | 成本 | 質量 | 推薦場景 |
|------|------|------|----------|
| GPT-4o + o4-mini | 中 | 高 | 日常分析 ⭐ |
| Claude + GPT-4o | 高 | 最高 | 重要決策 |
| Llama + Qwen | 低 | 中 | 高頻測試 |

---

## 📊 效果對比

### 單模型辯論輸出

```
多頭 (GPT-4o): "技術面看漲..."
空頭 (GPT-4o): "但風險在於..."
→ 思維模式相似，辯論深度有限
```

### 多模型辯論輸出

```
多頭 (Claude 3.5): "從風險管理角度，當前..."
空頭 (GPT-4o): "相反，從創新週期看..."
→ 完全不同的分析框架
→ 真正的觀點碰撞
→ 發現更多盲點
```

---

## 🐛 故障排除

### 問題 1: OpenRouter API 錯誤

```
錯誤: 未找到 OPENROUTER_API_KEY 環境變量
```

**解決方案:**
1. 註冊 OpenRouter: https://openrouter.ai/
2. 獲取 API Key
3. 添加到 `.env`:
   ```
   OPENROUTER_API_KEY=sk-or-your-key
   ```

### 問題 2: 模型不可用

```
錯誤: Model not found
```

**解決方案:**
1. 檢查模型名稱是否正確
2. 查看 OpenRouter 文檔: https://openrouter.ai/docs
3. 確認 API Key 有權限訪問該模型

### 問題 3: 成本過高

**解決方案:**
1. 使用較小的模型 (如 GPT-4o-mini, Claude Haiku)
2. 使用開源模型 (Llama, Qwen)
3. 關閉多模型辯論: `ENABLE_MULTI_MODEL_DEBATE = False`

---

## 💡 最佳實踐

### 1. 模型選擇策略

**多頭 (樂觀方)**: 選擇創新、激進的模型
- ✅ GPT-4o: 善於發現機會
- ✅ Gemini: 數據驅動樂觀

**空頭 (謹慎方)**: 選擇保守、穩健的模型
- ✅ Claude: 風險識別強
- ✅ o4-mini: 深度推理

### 2. 成本控制

```python
# 日常分析: 使用經濟組合
BULL_RESEARCHER_MODEL = {"provider": "openai", "model": "gpt-4o-mini"}
BEAR_RESEARCHER_MODEL = {"provider": "openai", "model": "gpt-4o-mini"}

# 重要決策: 使用頂級組合
BULL_RESEARCHER_MODEL = {"provider": "openrouter", "model": "anthropic/claude-3.5-sonnet"}
BEAR_RESEARCHER_MODEL = {"provider": "openrouter", "model": "openai/gpt-4o"}
```

### 3. 監控輸出

查看控制台輸出，確認使用的模型:

```
[節點 3/7] 研究團隊 (多空辯論)...
  🎭 啟用多模型辯論
  🐂 多頭研究員使用模型: anthropic/claude-3.5-sonnet
  🐻 空頭研究員使用模型: openai/gpt-4o
```

---

## 📈 預期效果

### 分析質量提升

| 指標 | 單模型 | 多模型 | 提升 |
|------|--------|--------|------|
| 觀點多樣性 | 3/5 | 5/5 | +67% |
| 風險識別 | 3/5 | 4.5/5 | +50% |
| 辯論深度 | 3/5 | 4.5/5 | +50% |
| 決策可信度 | 3.5/5 | 4.5/5 | +29% |

### 實際案例

**單模型辯論:**
```
信心度差異: 5% (65% vs 60%)
→ 觀點接近，難以判斷
```

**多模型辯論:**
```
信心度差異: 25% (75% vs 50%)
→ 明顯分歧，更易決策
→ Claude 保守看空，GPT 樂觀看多
→ 提供清晰的決策依據
```

---

## 🎓 進階功能

### 動態模型選擇

未來可以根據市場條件動態選擇模型:

```python
# 概念代碼 (未實現)
if market_volatility > 0.05:
    # 高波動: 用保守模型
    BULL_RESEARCHER_MODEL = {"provider": "openrouter", "model": "anthropic/claude-3.5-sonnet"}
else:
    # 低波動: 用激進模型
    BULL_RESEARCHER_MODEL = {"provider": "openrouter", "model": "openai/gpt-4o"}
```

### 三方辯論

未來可以添加第三方"仲裁者":

```python
# 概念代碼 (未實現)
NEUTRAL_RESEARCHER_MODEL = {
    "provider": "openrouter",
    "model": "google/gemini-pro-1.5",
}
```

---

## 📚 相關資源

- **OpenRouter 官網**: https://openrouter.ai/
- **模型排行榜**: https://openrouter.ai/rankings
- **API 文檔**: https://openrouter.ai/docs
- **價格對比**: https://openrouter.ai/models

---

## ✅ 檢查清單

在啟用多模型辯論前，確保:

- [ ] ✅ 已設置 `OPENAI_API_KEY` (如果使用 OpenAI 模型)
- [ ] ✅ 已設置 `OPENROUTER_API_KEY` (如果使用 OpenRouter)
- [ ] ✅ 在 `config.py` 中配置了 `BULL_RESEARCHER_MODEL`
- [ ] ✅ 在 `config.py` 中配置了 `BEAR_RESEARCHER_MODEL`
- [ ] ✅ 設置 `ENABLE_MULTI_MODEL_DEBATE = True`
- [ ] ✅ 測試過 API 連接正常
- [ ] ✅ 了解各模型的成本

---

**開始體驗多模型辯論，讓不同的 AI "大腦" 為你的投資決策提供更全面的視角！** 🚀
